## Особенности

*   **Синхронизация по субтитрам**: Видеоряд генерируется в соответствии с временными метками каждой строки субтитров.
*   **Случайный видеоряд**: Для каждого сегмента субтитра выбирается случайный фрагмент из ваших исходных видеофайлов.
*   **Стилизация текста**: Попытка воспроизвести основные стили, заданные в файле .ASS (шрифт, размер, цвет, выравнивание, обводка).
*   **Фоновая музыка**: Наложение выбранного аудиофайла на весь монтаж.
*   **Пакетная обработка**: Возможность создать несколько уникальных монтажей за один запуск.
*   **Настройка длительности**: Опции для задания максимальной и минимальной длительности итогового видео.
*   **Кроссплатформенность**: Должен работать на Windows, macOS и Linux при наличии всех зависимостей.

## Требования

Перед использованием скрипта убедитесь, что у вас установлены:

1.  **Python**: Версия 3.7 или новее. Скачать можно с [python.org](https://python.org/).
    *   При установке на Windows обязательно поставьте галочку "Add Python to PATH".
2.  **FFmpeg**: Мощный инструмент для работы с аудио и видео. MoviePy использует его для чтения и записи медиафайлов.
    *   Скачайте FFmpeg с [официального сайта](https://ffmpeg.org/download.html) или с [gyan.dev](https://www.gyan.dev/ffmpeg/builds/) (для Windows).
    *   **Важно**: FFmpeg должен быть доступен в системной переменной `PATH`, ИЛИ файлы `ffmpeg.exe` и `ffprobe.exe` (для Windows) должны находиться в той же директории, что и скрипт `main_cli.py`.
3.  **Библиотеки Python**: Список необходимых библиотек находится в файле `requirements.txt`.

## Подготовка к работе

1.  **Клонируйте или скачайте проект**:
    Если проект находится в Git-репозитории:
    ```bash
    git clone [URL_репозитория]
    cd [название_папки_проекта]
    ```
    Или просто скачайте и распакуйте файлы проекта в одну папку.

2.  **Создайте виртуальное окружение** (настоятельно рекомендуется для изоляции зависимостей проекта):
    Откройте терминал или командную строку в папке проекта и выполните:
    ```bash
    python -m venv .venv
    ```

3.  **Активируйте виртуальное окружение**:
    *   **Windows (cmd.exe)**:
        ```cmd
        .\.venv\Scripts\activate.bat
        ```
    *   **Windows (PowerShell)**:
        ```powershell
        .\.venv\Scripts\Activate.ps1
        ```
        (Если выполнение скриптов PowerShell запрещено, выполните сначала `Set-ExecutionPolicy Unrestricted -Scope Process` в PowerShell, запущенном от имени администратора).
    *   **Linux / macOS (bash/zsh)**:
        ```bash
        source .venv/bin/activate
        ```
    После активации в начале строки терминала должно появиться `(.venv)`.

4.  **Установите FFmpeg**:
    *   Следуйте инструкциям для вашей операционной системы.
    *   **Простой способ для Windows**: Скопируйте `ffmpeg.exe` и `ffprobe.exe` из скачанного архива FFmpeg (обычно из папки `bin`) в ту же папку, где находится `main_cli.py`.

5.  **Установите Python-библиотеки**:
    Находясь в активированном виртуальном окружении, выполните:
    ```bash
    pip install -r requirements.txt
    ```

## Подготовка медиафайлов

1.  **Видео**: Поместите ваши исходные видеофайлы (например, .mp4, .mov, .avi) в папку (`input_videos`).
2.  **Аудио**: Поместите файлы фоновой музыки (например, .mp3, .wav) в папку (`input_audio`).
3.  **Субтитры**: Создайте файл субтитров в формате `.ASS` с помощью редактора, такого как [Aegisub](http://www.aegisub.org/). В этом файле вы задаете текст и тайминги (когда каждая фраза появляется и исчезает), а также можете настроить стили. Поместите этот `.ass` файл, например, в папку `input_subtitles`.
4.  **Выходная папка**: Создайте папку, куда будут сохраняться готовые видео (например, `output_videos`), или скрипт создаст ее сам, если указанный путь не существует.

## Использование скрипта

Скрипт запускается из командной строки (терминала) из папки проекта (убедитесь, что виртуальное окружение активировано).

**Основной формат команды:**

```bash
python main_cli.py --video_dir <путь_к_папке_с_видео> \
                   --audio_dir <путь_к_папке_с_аудио> \
                   --subtitle_ass_file <путь_к_файлу.ass> \
                   --output_dir <путь_к_папке_для_результата> \
                   [дополнительные_опции]


Обязательные аргументы:

-vd, --video_dir: Путь к папке с вашими исходными видеофайлами.

-ad, --audio_dir: Путь к папке с вашими аудиофайлами для фона.

-sub, --subtitle_ass_file: Путь к вашему .ASS файлу субтитров.

-od, --output_dir: Путь к папке, куда будут сохранены готовые видеомонтажи.

Дополнительные опции:

-n, --num_montages <число>: Количество видеомонтажей, которое нужно создать. Каждый монтаж будет использовать указанный файл субтитров, но случайный аудиофайл (если их несколько) и случайные видеофрагменты. По умолчанию: 1.

-max_dur, --max_duration <секунды>: Максимальная длительность одного видеомонтажа. Если 0 (по умолчанию), длительность определяется временем окончания последнего субтитра.

-min_dur, --min_duration <секунды>: Минимально допустимая длительность монтажа. Если итоговый монтаж короче, он не будет создан (если значение больше 0). По умолчанию: 0 (нет проверки).

-h, --help: Показать справочное сообщение со всеми аргументами и выйти.

Примеры команд:

Создать один монтаж, используя все субтитры, со случайным аудио:

python main_cli.py --video_dir ./input_videos --audio_dir ./input_audio --subtitle_ass_file ./input_subtitles/story.ass --output_dir ./output_videos
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution.
Bash

Создать 3 монтажа, каждый не длиннее 45 секунд:

python main_cli.py -vd ./input_videos -ad ./input_audio -sub ./input_subtitles/script.ass -od ./output_videos -n 3 -max_dur 45
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution.
Bash

Создать 1 монтаж, который должен быть не короче 30 секунд (если субтитры позволяют):

python main_cli.py -vd ./input_videos -ad ./input_audio -sub ./input_subtitles/short_script.ass -od ./output_videos -min_dur 30
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution.
Bash

Примечания по работе

Стили ASS: Скрипт пытается извлечь и применить основные атрибуты стиля (шрифт, размер, основной цвет, цвет обводки, толщина обводки, выравнивание) из секции [V4+ Styles] вашего ASS-файла. Сложные теги форматирования внутри текста ({\...}) будут удалены перед рендерингом текста. Для наилучшего соответствия стилям рекомендуется использовать простые, но четко определенные стили в Aegisub.

Производительность: Обработка видео — ресурсоемкая задача. Время создания монтажа зависит от количества исходных видео, их разрешения, длительности итогового видео и мощности вашего компьютера. Использование пресета ultrafast для кодирования ускоряет процесс, но может незначительно снизить качество.

Случайность: Выбор видеофрагментов для каждого сегмента субтитра происходит случайно. Если вы запускаете скрипт несколько раз с теми же параметрами для создания нескольких монтажей (-n > 1), каждый монтаж будет уникальным по видеоряду. Аудиофайл для фона также выбирается случайно для каждого создаваемого монтажа, если в папке аудио несколько файлов.

Устранение неполадок

ffmpeg: command not found или похожие ошибки: Убедитесь, что FFmpeg установлен и его путь прописан в системную переменную PATH, или ffmpeg.exe (для Windows) находится в той же папке, что и main_cli.py.

Ошибки импорта библиотек (ImportError): Убедитесь, что вы активировали виртуальное окружение и выполнили pip install -r requirements.txt.

Видео не создается / ошибки при обработке: Проверьте пути к файлам и папкам. Убедитесь, что исходные медиафайлы не повреждены и поддерживаются FFmpeg. Логи в консоли могут содержать информацию об ошибке.

Неправильно отображаются русские/нестандартные символы в субтитрах: Убедитесь, что ваш .ASS файл сохранен в кодировке UTF-8 (Aegisub обычно делает это по умолчанию).
